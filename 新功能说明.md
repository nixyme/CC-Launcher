# 新功能说明

## 更新概要

本次更新实现了两个核心功能:

### 1. ✨ 命令列表支持 (多命令编辑)

之前版本只支持单个默认命令,现在支持多条命令的编辑和管理。

#### 新增功能:

- **多行命令编辑**: 在命令列表区域,每行输入一条命令
- **添加命令**: 点击 "+ 添加命令" 按钮快速添加新命令模板
- **执行所有命令**: 一键执行所有命令(命令间用 && 连接)
- **执行选中命令**: 选中特定命令文本后,只执行选中的命令
- **重置命令**: 恢复到最后保存的命令列表

#### 使用示例:

```
# 第一条命令:清理缓存
rm -rf .cache

# 第二条命令:构建项目
npm run build

# 第三条命令:运行测试
npm test
```

### 2. 💾 实时自动保存

所有配置更改都会自动保存到 `data/projects.json`,无需担心数据丢失。

#### 保存机制:

- **自动保存**: 编辑命令后,1秒内无新输入时自动保存
- **手动保存**: 点击 "保存命令列表" 按钮立即保存
- **静默保存**: 自动保存不会打断你的工作
- **持久化存储**: 所有数据实时写入独立的 JSON 文件

#### 保存的内容:

- 项目名称、路径
- 结果路径
- 完整的命令列表
- 项目排序信息

## 界面变化

### 命令列表区域

```
┌─────────────────────────────────────────────┐
│ 命令列表 (可编辑多条命令)                  │
│                                             │
│ [+ 添加命令] [保存命令列表]                 │
│                                             │
│ ┌─────────────────────────────────────────┐ │
│ │ echo 'First command'                    │ │
│ │                                         │ │
│ │ echo 'Second command'                   │ │
│ │                                         │ │
│ │ echo 'Third command'                    │ │
│ └─────────────────────────────────────────┘ │
│                                             │
│ [🚀 执行所有命令] [📋 执行选中命令]         │
│ [📂 查看结果] [重置命令]                    │
└─────────────────────────────────────────────┘
```

### 按钮说明

| 按钮 | 功能 | 说明 |
|------|------|------|
| + 添加命令 | 添加新命令模板 | 在末尾添加 "# 新命令: " |
| 保存命令列表 | 手动保存 | 立即保存到文件(有提示) |
| 🚀 执行所有命令 | 执行全部 | 按顺序执行所有命令 |
| 📋 执行选中命令 | 执行选中 | 只执行你选中的命令 |
| 📂 查看结果 | 打开结果文件夹 | 在 Finder 中打开 |
| 重置命令 | 恢复原状 | 恢复到最后保存的状态 |

## 数据格式

`data/projects.json` 中的项目数据结构:

```json
{
  "id": "uuid",
  "name": "项目名称",
  "path": "/path/to/project",
  "result_path": "/path/to/results",
  "default_command": "第一条命令(兼容旧版)",
  "commands": [
    "第一条命令",
    "第二条命令",
    "第三条命令"
  ],
  "order": 0
}
```

## 兼容性

### 向后兼容

- ✅ 旧版本的 `default_command` 会自动转换为 `commands` 列表
- ✅ 已有项目会自动迁移,无需手动操作
- ✅ 数据格式完全兼容旧版本

### 数据安全

- ✅ 所有修改都保存到独立的 JSON 文件
- ✅ UTF-8 编码,支持中文
- ✅ 自动创建 `data/` 目录
- ✅ 实时保存,避免数据丢失

## 使用技巧

### 1. 多命令执行

```
# 示例:前端项目构建流程
npm install
npm run lint
npm run build
npm run test
```

点击 "执行所有命令",等价于:
```bash
npm install && npm run lint && npm run build && npm run test
```

### 2. 选择性执行

如果只想执行 `npm run build`,选中这一行,然后点击 "执行选中命令"。

### 3. 命令注释

```
# 这是注释,不会被执行
echo 'This will be executed'

# 另一个注释
echo 'This too'
```

### 4. 复杂命令

```
# 条件执行
test -f package.json && npm install

# 多行命令(使用反斜杠)
docker run -d \
  --name my-app \
  -p 8080:80 \
  my-image:latest
```

## 快速开始

1. **启动应用**
   ```bash
   ./run.sh
   ```

2. **添加项目**
   - 点击 "添加项目"
   - 填写项目信息
   - 在命令列表中输入多条命令(每行一条)
   - 点击 "添加"

3. **编辑命令**
   - 选择项目
   - 直接编辑命令列表
   - 自动保存,无需手动操作

4. **执行命令**
   - 点击 "执行所有命令" 运行全部
   - 或选中特定命令,点击 "执行选中命令"

## 测试验证

运行测试脚本验证功能:

```bash
python3 test_commands.py
```

应该看到:
```
============================================================
所有测试通过! ✓
============================================================
```

## 故障排除

### 自动保存不工作?

- 确保选中了项目
- 检查 `data/projects.json` 文件权限
- 查看控制台错误信息

### 命令执行失败?

- 确认项目路径正确
- 检查命令语法
- 查看终端窗口的错误输出

### 数据丢失?

- 数据实时保存到 `data/projects.json`
- 可以手动备份这个文件
- 编辑后1秒自动保存

## 技术细节

### 实时保存实现

使用防抖(debounce)机制:

1. 用户输入时触发 `_on_commands_changed`
2. 取消之前的保存定时器
3. 设置1秒后执行 `_auto_save_commands`
4. 如果1秒内继续输入,重新计时
5. 停止输入1秒后自动保存

### 命令执行逻辑

- **执行所有命令**: 用 `&&` 连接所有命令
- **执行选中命令**: 只执行选中的文本
- **无选中时**: 默认执行第一条命令

### 数据迁移

旧版本数据自动迁移:
```python
if 'commands' not in project:
    project['commands'] = [project.get('default_command', '')]
```

## 更新日志

### v2.0 (当前版本)

- ✨ 新增多命令列表支持
- 💾 实现实时自动保存
- 🔄 命令执行模式:全部/选中
- 📝 改进界面提示和说明
- ✅ 完整测试覆盖

### v1.0 (之前版本)

- 基础项目管理
- 单命令执行
- 手动保存

---

**享受新功能!** 如有问题,请查看 README.md 或提交 Issue。
